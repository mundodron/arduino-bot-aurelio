 /*local_address*/ SELECT ser.service_inactive_dt, case when length(trim(translate( equ.external_id , '0123456789', ' '))) is null then Case when equ.external_id_type = 6 then Case when substr(equ.external_id, 3, 3) not in ('000','100') then 1 else 2 end when equ.external_id like '0800%' or equ.external_id like '800%' then 4 else 3 end when equ.external_id_type = 6 then 5 when equ.external_id_type = 1 then 6 when equ.external_id_type <> 10 then 8 else 7 end ORDEM, decode(equ.external_id_type,6,' 6, TELEFONE',7,' 7, Circ.Dados',1,' 1, Ident.Fatura',9,' 9, Internet',10,'10, TV',equ.external_id_type) TIPO, equ.external_id EQUIP_EXTERNAL_ID, UPPER(replace(replace(replace(replace(replace( trim( Case when address_1 like '%(GVT%' then substr(address_1, 1, instr(address_1,'(GVT')-1 ) when LENGTH(TRIM(TRANSLATE( substr(trim(address_1), instr(trim(address_1),' ',-1,1)+1 ) , '0123456789', ' '))) is null and substr(address_1, instr(address_1,' ', -1,2), instr(address_1,' ', -1,1)-instr(address_1,' ', -1,2) )  not like '% AP%' then substr(address_1, 1, instr(trim(address_1),' ',-1,1) ) when substr(address_1, instr(address_1,' ',-1,1) ) in (' S/N', ' SN') then substr(address_1, 1, instr(address_1,' ',-1,1)-1 ) else address_1 end ),'        ',' '), '  ',' '), 'null ',''), ' .',''),',',' ')) SERVICE_LOGRADOURO, CASE when LENGTH(TRIM(TRANSLATE( substr(trim(address_1), instr(trim(address_1),' ',-1,1)+1 ) , '0123456789', ' '))) is null and  substr(address_1, instr(address_1,' ', -1,2), instr(address_1,' ', -1,1)-instr(address_1,' ', -1,2) )  not like '% AP%' then substr(trim(address_1), instr(trim(address_1),' ',-1,1)+1 )
/*local_address*/ else '0' end SERVICE_NUMERO, lad.address_2, substr(upper(trim(replace(lad.address_2,'; ;',''))),1,60) SERVICE_COMPLEMENTO, substr(upper(trim(lad.address_3)),1,60) SERVICE_BAIRRO, substr(upper(trim(lad.city)),1,50) SERVICE_CIDADE, substr(upper(trim(lad.state)),1,2) SERVICE_UF, lpad(nvl(trim(substr(translate(UPPER(lad.postal_code) ,'''@()=+,:;.?/\цуг-*ABCDEFGHIJKLMNOPQRSTUVXYWZ', ' '),1,8) ),'0'),8,'0')  SERVICE_CEP FROM service ser, customer_id_equip_map equ, Local_address lad, service_address_assoc saa WHERE ser.subscr_no = equ.subscr_no AND ser.subscr_no_resets = equ.subscr_no_resets AND ser.subscr_no = equ.subscr_no AND equ.external_id_type IN (1,6,7) AND lad.address_id = saa.address_id AND saa.account_no = ser.parent_account_no AND saa.subscr_no = ser.subscr_no AND saa.subscr_no_resets  = ser.subscr_no_resets and saa.association_status = 2     
/*###*/   and ser.parent_account_no = 8541693      ORDER BY 2, ser.service_inactive_dt DESC;